<!-- layouts/_partials/map.html -->


<div id="{{ .id }}" class="map"></div>


<script>

    var points = {{ .points | jsonify | safeJS }};
    var initialZoom = {{ with .zoom  }}{{ . }}{{ else }} 0 {{ end }};
    var bounds = new L.LatLngBounds(points.map(p=>{
        return [p.latitude,p.longitude];
    }));
    var mymap = L.map("{{- .id -}}").fitBounds(bounds);
    L.tileLayer(
      "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      {
        zoom: 1,
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }
    ).addTo(mymap);

    points.forEach(loc=>{
        let marker = L.marker([loc.latitude,loc.longitude]).addTo(mymap);
		let content = `<div><a href="geo:${loc.latitude},${loc.longitude}">Open In App</a></div>`;
		marker.bindPopup(content,{closeOnClick: false, autoClose: false}).openPopup();
    });

</script>


